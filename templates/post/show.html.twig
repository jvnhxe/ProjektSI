{% extends 'base.html.twig' %}

{% block title %}{{ post.title }}{% endblock %}

{% block body %}
    <div class="container mt-4">
        <div class="row">
            <div class="col-lg-8 mx-auto">
                <h1>{{ post.title }}</h1>

                {% set badge = post.status == 'published' ? 'success' : 'secondary' %}
                <span class="badge bg-{{ badge }}">{{ post.status }}</span>

                {% if post.imageName %}
                    <img src="{{ vich_uploader_asset(post, 'imageFile') }}"
                         class="img-fluid mb-4"
                         alt="{{ post.title }}">
                {% endif %}

                <div class="mb-3">
                    <small class="text-muted">Published on {{ post.createdAt|date('F j, Y') }}</small>
                </div>

                <div class="content">
                    {{ post.content|nl2br }}
                </div>

                <h1>{{ 'title.comment_list'|trans }}</h1>
                {% if commentPagination is defined and commentPagination.items|length %}

                    <div class="navigation text-center">
                        {{ knp_pagination_render(commentPagination) }}
                    </div>

                    <table class="table table-striped">
                        <thead>
                        <tr>
                            <th>{{ knp_pagination_sortable(commentPagination, 'label.id'|trans, 'comment.id') }}</th>
                            <th>{{ knp_pagination_sortable(commentPagination, 'label.author'|trans, 'comment.nick') }}</th>
                            <th>{{ knp_pagination_sortable(commentPagination, 'label.content'|trans, 'comment.content') }}</th>
                            {% if is_granted("ROLE_ADMIN") %}
                                <th>{{ 'label.actions'|trans }}</th>
                            {% endif %}
                        </tr>
                        </thead>
                        <tbody>
                        {% for comment in commentPagination.items %}
                            <tr>
                                <td>{{ comment.id }}</td>
                                <td>{{ comment.nick }}</td>
                                <td>{{ comment.content }}</td>
                                {% if is_granted('ROLE_ADMIN', comment) %}
                                    <td>
                                        <a class="btn btn-outline-danger" href="{{ url('comment_delete', {id: comment.id}) }}" title="{{ 'action.delete'|trans }}">
                                            {{ 'action.delete'|trans }}
                                        </a>
                                    </td>
                                {% endif %}
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>

                    <div class="navigation text-center">
                        {{ knp_pagination_render(commentPagination) }}
                    </div>

                {% else %}
                    <p>
                        {% include 'default/_single_alert_message.html.twig' with {
                            type: 'warning',
                            message: 'message.empty_commentlist'|trans
                        } %}
                    </p>
                {% endif %}

                <p>
                    <a class="btn btn-outline-primary" href="{{ url('comment_create', {id: post.id}) }}" title="{{ 'action.comment_create'|trans }}">
                        {{ 'action.comment_create'|trans }}
                    </a>
                </p>


                <div class="mt-4">
                    <a href="{{ path('post_edit', {id: post.id}) }}" class="btn btn-primary">Edit</a>
                    <a href="{{ path('post_index') }}" class="btn btn-secondary">Back to Posts</a>
                </div>
            </div>
        </div>
    </div>
{% endblock %}